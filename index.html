<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Santander - Dashboard de Classificação Empresarial</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/css/styles.css">


  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <img src="./images/santander_logo.png" alt="logo santander" height="75" />
        <div class="nav-tabs">
          <button class="tab active" onclick="showTab('overview')">
            Visão Geral
          </button>
          <button class="tab" onclick="showTab('analysis')">
            Análise de Perfis
          </button>
          <button class="tab" onclick="showTab('insights')">Insights</button>
          <button class="tab" onclick="showTab('performance')">
            Performance
          </button>
          <button class="tab" onclick="showTab('dados-reais')">
            Dados Reais
          </button>
        </div>
      </div>

      <!-- Overview Tab -->
      <div id="overview" class="dashboard-content active">
        <!-- Alertas -->
        <div class="alert-panel">
          <h3 style="margin-bottom: 15px; color: #333">
            <i class="fas fa-exclamation-triangle"></i> Alertas em Tempo Real
          </h3>
          <div class="alert-item">
            <i class="fas fa-warning alert-icon"></i>
            <span
              >15 empresas mudaram de perfil "Madura" para "Declínio" nas
              últimas 24h</span
            >
          </div>
          <div class="alert-item">
            <i class="fas fa-chart-line alert-icon"></i>
            <span
              >Detectado aumento de 23% em transações atípicas no setor de
              varejo</span
            >
          </div>
        </div>

        <!-- Métricas Principais -->
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-icon declinio">
              <i class="fas fa-arrow-down"></i>
            </div>
            <div class="metric-value declinio">2,847</div>
            <div class="metric-label">Empresas em Declínio</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon expansao">
              <i class="fas fa-arrow-up"></i>
            </div>
            <div class="metric-value expansao">5,234</div>
            <div class="metric-label">Empresas em Expansão</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon inicio">
              <i class="fas fa-rocket"></i>
            </div>
            <div class="metric-value inicio">1,892</div>
            <div class="metric-label">Empresas Iniciantes</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon madura">
              <i class="fas fa-crown"></i>
            </div>
            <div class="metric-value madura">8,756</div>
            <div class="metric-label">Empresas Maduras</div>
          </div>
        </div>

        <!-- Gráficos -->
        <div class="charts-grid">
          <div class="chart-container">
            <h3 class="chart-title">Distribuição de Perfis por Região</h3>
            <canvas id="regionChart" width="400" height="200"></canvas>
          </div>
          <div class="chart-container">
            <h3 class="chart-title">Evolução Temporal dos Perfis</h3>
            <canvas id="timelineChart" width="400" height="200"></canvas>
          </div>
        </div>

        <!-- Mapa -->
        <div class="chart-container">
          <h3 class="chart-title">Mapa de Distribuição Geográfica</h3>
          <div id="map" class="map-container"></div>
        </div>
      </div>

      <!-- Analysis Tab -->
      <div id="analysis" class="dashboard-content">
        <!-- Filtros -->
        <div class="filters-section">
          <h3 style="margin-bottom: 15px; color: #333">
            <i class="fas fa-filter"></i> Filtros de Análise
          </h3>
          <div class="filters-grid">
            <div class="filter-group">
              <label class="filter-label">Setor</label>
              <select class="filter-select">
                <option>Todos</option>
                <option>Tecnologia</option>
                <option>Varejo</option>
                <option>Saúde</option>
                <option>Educação</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Região</label>
              <select class="filter-select">
                <option>Todas</option>
                <option>Sudeste</option>
                <option>Sul</option>
                <option>Nordeste</option>
                <option>Norte</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Período</label>
              <input type="month" class="filter-input" value="2025-05" />
            </div>
            <div class="filter-group">
              <label class="filter-label">Sazonalidade</label>
              <select class="filter-select">
                <option>Anual</option>
                <option>Trimestral</option>
                <option>Mensal</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Plano Cartesiano -->
        <div class="chart-container">
          <h3 class="chart-title">Plano Cartesiano de Classificação</h3>
          <p style="margin-bottom: 20px; color: #666">
            Eixo X: Pagamentos ← → Recebimentos | Eixo Y: Créditos ↑ ↓
            Investimentos
          </p>
          <div class="cartesian-plane" id="cartesianPlane">
            <div class="axis axis-x"></div>
            <div class="axis axis-y"></div>

            <!-- Labels dos eixos -->
            <div class="axis-label" style="top: 45%; right: 10px">
              Pagamentos
            </div>
            <div class="axis-label" style="top: 45%; left: 10px">
              Recebimentos
            </div>
            <div class="axis-label" style="bottom: 10px; left: 45%">
              Investimentos
            </div>
            <div class="axis-label" style="top: 10px; left: 48%">Créditos</div>
          </div>
        </div>
      </div>

      <!-- Insights Tab -->
      <div id="insights" class="dashboard-content">
        <div class="insights-grid">
          <div class="insight-card">
            <h3 class="insight-title">
              <i class="fas fa-bullseye"></i> Oportunidades de Negócio
            </h3>
            <div class="insight-item">
              <strong>Empresas em Expansão:</strong> Oferecer linhas de crédito
              para capital de giro com juros preferenciais
            </div>
            <div class="insight-item">
              <strong>Empresas Iniciantes:</strong> Pacotes completos de
              serviços bancários digitais com taxas reduzidas
            </div>
            <div class="insight-item">
              <strong>Empresas Maduras:</strong> Produtos de investimento e
              gestão patrimonial personalizada
            </div>
          </div>

          <div class="insight-card">
            <h3 class="insight-title">
              <i class="fas fa-crystal-ball"></i> Análise Preditiva
            </h3>
            <div class="insight-item">
              <strong>Próximos 30 dias:</strong> 340 empresas podem migrar de
              "Início" para "Expansão"
            </div>
            <div class="insight-item">
              <strong>Tendência trimestral:</strong> Setor de tecnologia mostra
              sinais de crescimento acelerado
            </div>
            <div class="insight-item">
              <strong>Projeção anual:</strong> 15% das empresas maduras podem
              precisar de reestruturação financeira
            </div>
          </div>

          <div class="insight-card">
            <h3 class="insight-title">
              <i class="fas fa-shield-alt"></i> Prevenção de Riscos
            </h3>
            <div class="insight-item">
              <strong>Alto Risco:</strong> 12 empresas com padrão transacional
              atípico nas últimas 72h
            </div>
            <div class="insight-item">
              <strong>Monitoramento:</strong> Empresas de varejo com queda de
              40% nos recebimentos
            </div>
            <div class="insight-item">
              <strong>Ação Recomendada:</strong> Revisão de limites de crédito
              para 85 empresas identificadas
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Tab -->
      <div id="performance" class="dashboard-content">
        <!-- Métricas do Modelo -->
        <div class="chart-container">
          <h3 class="chart-title">
            <i class="fas fa-cogs"></i> Métricas do Modelo de Machine Learning
          </h3>
          <div class="performance-metrics">
            <div class="performance-card">
              <div class="performance-value">94.7%</div>
              <div class="performance-label">Acurácia</div>
            </div>
            <div class="performance-card">
              <div class="performance-value">92.3%</div>
              <div class="performance-label">Precisão</div>
            </div>
            <div class="performance-card">
              <div class="performance-value">89.8%</div>
              <div class="performance-label">Recall</div>
            </div>
            <div class="performance-card">
              <div class="performance-value">91.0%</div>
              <div class="performance-label">F1-Score</div>
            </div>
          </div>
        </div>

        <!-- Gráficos de Performance -->
        <div class="charts-grid">
          <div class="chart-container">
            <h3 class="chart-title">Precisão por Perfil de Empresa</h3>
            <canvas id="precisionChart" width="400" height="200"></canvas>
          </div>
          <div class="chart-container">
            <h3 class="chart-title">Análise de Sazonalidade</h3>
            <canvas id="seasonalityChart" width="400" height="200"></canvas>
          </div>
        </div>
      </div>

      <!-- Dados Reais Tab -->
      <div id="dados-reais" class="dashboard-content">
        <!-- Erro Message -->
        <div id="errorMessage" class="error-message" style="display: none;"></div>
        
        <!-- Estatísticas do Banco -->
        <div class="api-stats-section">
          <h3 style="margin-bottom: 15px; color: #333">
            <i class="fas fa-database"></i> Estatísticas do Banco de Dados
          </h3>
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="metric-value" id="totalClientes">-</div>
              <div class="metric-label">Total de Clientes</div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">
                <i class="fas fa-exchange-alt"></i>
              </div>
              <div class="metric-value" id="totalTransacoes">-</div>
              <div class="metric-label">Total de Transações</div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">
                <i class="fas fa-dollar-sign"></i>
              </div>
              <div class="metric-value" id="valorTotalTransacoes">-</div>
              <div class="metric-label">Valor Total Transacionado</div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="metric-value" id="faturamentoTotal">-</div>
              <div class="metric-label">Faturamento Total</div>
            </div>
          </div>
        </div>

        <!-- Busca de Cliente -->
        <div class="search-section">
          <h3 style="margin-bottom: 15px; color: #333">
            <i class="fas fa-search"></i> Buscar Cliente
          </h3>
          <div class="search-container">
            <div class="search-input-wrapper">
              <input 
                type="text" 
                id="clienteSearch" 
                placeholder="Digite o ID do cliente ou comece a digitar para filtrar..." 
                class="search-input"
                autocomplete="off"
              />
              <div id="clientesDropdown" class="clientes-dropdown" style="display: none;"></div>
            </div>
            <button id="searchClienteBtn" class="search-button">
              <i class="fas fa-search"></i> Buscar
            </button>
          </div>
          <div id="clienteInfo" class="cliente-info"></div>
        </div>

        <!-- Gráfico de Faturamento por CNAE -->
        <div class="chart-container">
          <h3 class="chart-title">Faturamento por CNAE</h3>
          <canvas id="faturamentoCNAE" width="400" height="200"></canvas>
        </div>

        <!-- Últimas Transações -->
        <div class="transactions-section">
          <h3 style="margin-bottom: 15px; color: #333">
            <i class="fas fa-list"></i> Últimas Transações
          </h3>
          <div class="table-container">
            <table class="transactions-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Pagador</th>
                  <th>Recebedor</th>
                  <th>Valor</th>
                  <th>Descrição</th>
                  <th>Data</th>
                </tr>
              </thead>
              <tbody id="transacoesTableBody">
                <tr>
                  <td colspan="6">Carregando...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Botão para abrir o chat -->
    <button id="openChatBtn" style="position:fixed;bottom:30px;right:30px;z-index:9999;background:#d50000;color:#fff;border:none;border-radius:50px;padding:18px 28px;font-size:18px;box-shadow:0 2px 8px rgba(0,0,0,0.15);cursor:pointer;">
      <i class="fas fa-comments"></i> Falar com o Chat
    </button>

    <!-- Modal do Chat -->
    <div id="chatModal" style="display:none;position:fixed;bottom:90px;right:30px;width:350px;max-width:95vw;height:480px;max-height:90vh;background:#fff;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.18);z-index:10000;flex-direction:column;overflow:hidden;">
      <div style="background:#d50000;color:#fff;padding:14px 18px;font-size:18px;font-weight:bold;display:flex;justify-content:space-between;align-items:center;">
        <span>Assistente Santander BI</span>
        <button id="closeChatBtn" style="background:none;border:none;color:#fff;font-size:22px;cursor:pointer;">&times;</button>
      </div>
      <div id="chatMessages" style="flex:1;overflow-y:auto;padding:16px;background:#fafafa;font-size:15px;"></div>
      <div style="padding:12px 16px;border-top:1px solid #eee;display:flex;gap:8px;">
        <input id="chatInput" type="text" placeholder="Digite sua pergunta..." style="flex:1;padding:10px;border-radius:6px;border:1px solid #ccc;font-size:15px;">
        <button id="sendChatBtn" style="background:#d50000;color:#fff;border:none;border-radius:6px;padding:0 16px;font-size:16px;cursor:pointer;">Enviar</button>
      </div>
    </div>

    <script>
      // Abrir/fechar modal
      const openBtn = document.getElementById('openChatBtn');
      const chatModal = document.getElementById('chatModal');
      const closeBtn = document.getElementById('closeChatBtn');
      openBtn.onclick = () => { chatModal.style.display = 'flex'; document.getElementById('chatInput').focus(); };
      closeBtn.onclick = () => { chatModal.style.display = 'none'; };

      // Mensagens
      const chatMessages = document.getElementById('chatMessages');
      function addMsg(text, sender) {
        const div = document.createElement('div');
        div.style.margin = '8px 0';
        div.style.padding = '8px 12px';
        div.style.borderRadius = '7px';
        div.style.maxWidth = '90%';
        div.style.wordBreak = 'break-word';
        div.style.background = sender === 'user' ? '#e3f2fd' : '#f1f8e9';
        div.style.alignSelf = sender === 'user' ? 'flex-end' : 'flex-start';
        div.textContent = text;
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      // Mensagem inicial
      addMsg('Olá! Sou a assistente virtual do Santander BI. Como posso ajudar?', 'bot');

      // Enviar mensagem
      const chatInput = document.getElementById('chatInput');
      const sendBtn = document.getElementById('sendChatBtn');
      function sendMessage() {
        const msg = chatInput.value.trim();
        if (!msg) return;
        addMsg(msg, 'user');
        chatInput.value = '';
        // Chama API Flask
        fetch('http://localhost:5000/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          
          body: JSON.stringify({ pergunta: msg })
        })
        .then(r => r.json())
        .then(data => {
          if (data.success) addMsg(data.resposta, 'bot');
          else addMsg('Erro: ' + (data.error || 'Falha na resposta.'), 'bot');
        })
        .catch(() => addMsg('Erro de conexão. Tente novamente.', 'bot'));
      }
      sendBtn.onclick = sendMessage;
      chatInput.onkeypress = e => { if (e.key === 'Enter') sendMessage(); };
    </script>
    <script src="/js/api-client.js"></script>
    <script src="/js/script.js"></script>
  </body>
</html>
